#!/usr/bin/env jruby

ROOT = File.expand_path(File.dirname(__FILE__))
require "#{ROOT}/../lib/rta"
require "optparse"
require "drb"
require "irb"

port = nil
begin
  op = OptionParser.new
  op.banner = "Usage: #{File.basename($0)} -p <port>\n\n" +
              "Example: jruby #{File.basename($0)} -p 9000\n\n" +
              "Option: "

  op.on('-p', '--port=NUMBER', Numeric, 'specify port number') { |arg|
    port = arg
  }
  op.on('-h', 'output help') {
    puts op.help
    exit 0
  }
  op.parse!
  raise "Missing port" unless port
rescue OptionParser::ParseError => err
  STDERR.puts err.message
  STDERR.puts op.help
  exit 1
rescue
  STDERR.puts $! if $!.to_s != ""
  STDERR.puts op.help
  exit 1
end

DRb.start_service
$rta = DRbObject.new_with_uri("druby://localhost:#{port}")

IRB.start(__FILE__)
